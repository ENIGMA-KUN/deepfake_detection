<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deepfake Detection Platform</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <style>
        .drop-zone {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        .drop-zone--over {
            border-color: #4f46e5;
            background-color: rgba(79, 70, 229, 0.1);
        }
        .drop-zone__prompt {
            margin-bottom: 15px;
            font-size: 1.2em;
            color: #888;
        }
        .drop-zone__thumb {
            width: 100%;
            max-height: 300px;
            overflow: hidden;
            border-radius: 8px;
            margin-bottom: 10px;
            display: none;
            position: relative;
        }
        .drop-zone__thumb img {
            width: 100%;
            height: auto;
            object-fit: contain;
        }
        .progress-bar {
            height: 8px;
            background-color: #e2e8f0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        .progress-bar__fill {
            height: 100%;
            background-color: #4f46e5;
            width: 0%;
            transition: width 0.3s ease;
        }
        .result-card {
            display: none;
            margin-top: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .real {
            border-left: 5px solid #10b981;
        }
        .fake {
            border-left: 5px solid #ef4444;
        }
        .confidence-meter {
            position: relative;
            height: 12px;
            background-color: #f3f4f6;
            border-radius: 6px;
            margin: 10px 0;
            overflow: hidden;
        }
        .confidence-fill {
            height: 100%;
            transition: width 1s ease;
        }
        .loading-spinner {
            display: none;
            margin: 20px auto;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="min-h-screen flex flex-col">
        <header class="bg-white shadow">
            <div class="max-w-5xl mx-auto py-4 px-4 sm:px-6 lg:px-8 flex items-center justify-between">
                <h1 class="text-2xl font-bold text-indigo-600">Deepfake Detection Platform</h1>
                <div class="text-sm text-gray-500">Image Detection Module</div>
            </div>
        </header>

        <main class="flex-grow">
            <div class="max-w-5xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
                <div class="bg-white shadow rounded-lg p-6">
                    <h2 class="text-xl font-semibold mb-4">Upload an Image for Analysis</h2>
                    <p class="text-gray-600 mb-6">
                        Our AI system will analyze the image to determine if it's real or a deepfake.
                        The system looks for manipulation artifacts and inconsistencies that may not be visible to the human eye.
                    </p>

                    <div class="drop-zone" id="dropZone">
                        <div class="drop-zone__prompt">
                            <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <p class="mt-1">Drag & drop an image or click to browse</p>
                        </div>
                        <div class="drop-zone__thumb" id="previewContainer">
                            <img id="previewImage" src="" alt="Preview">
                        </div>
                        <input type="file" id="fileInput" accept="image/*" class="hidden">
                    </div>

                    <div class="progress-bar mt-4" id="progressBar">
                        <div class="progress-bar__fill" id="progressFill"></div>
                    </div>

                    <div class="loading-spinner" id="loadingSpinner">
                        <svg class="animate-spin h-8 w-8 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="text-center text-gray-600 mt-2">Analyzing image...</p>
                    </div>

                    <div class="result-card p-6" id="resultCard">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-medium" id="resultTitle">Analysis Results</h3>
                            <span class="px-3 py-1 rounded-full text-sm font-medium" id="resultBadge"></span>
                        </div>
                        
                        <div class="mt-4">
                            <div class="flex justify-between mb-1">
                                <span class="text-sm font-medium text-gray-700">Confidence Score</span>
                                <span class="text-sm font-medium text-gray-700" id="confidenceValue">0%</span>
                            </div>
                            <div class="confidence-meter">
                                <div class="confidence-fill" id="confidenceFill"></div>
                            </div>
                        </div>

                        <div class="mt-6 flex justify-between">
                            <div>
                                <h4 class="text-sm font-medium text-gray-700">Real probability</h4>
                                <p class="text-lg font-semibold" id="realProb">0%</p>
                            </div>
                            <div>
                                <h4 class="text-sm font-medium text-gray-700">Fake probability</h4>
                                <p class="text-lg font-semibold" id="fakeProb">0%</p>
                            </div>
                        </div>

                        <div class="mt-6">
                            <h4 class="text-sm font-medium text-gray-700 mb-2">Explanation</h4>
                            <p class="text-gray-600" id="explanation">
                                Our model analyzes various visual features to determine if an image has been manipulated.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="bg-white shadow rounded-lg p-6 mt-6">
                    <h2 class="text-xl font-semibold mb-4">About Deepfake Detection</h2>
                    <p class="text-gray-600 mb-3">
                        Deepfakes are synthetic media where a person's likeness is replaced with someone else's using AI techniques. 
                        Our detection system uses advanced machine learning models to identify manipulation artifacts and inconsistencies.
                    </p>
                    <p class="text-gray-600">
                        The system examines facial features, lighting consistency, and pixel-level patterns that may indicate 
                        an image has been artificially created or manipulated.
                    </p>
                </div>
            </div>
        </main>

        <footer class="bg-white border-t">
            <div class="max-w-5xl mx-auto py-4 px-4 sm:px-6 lg:px-8">
                <p class="text-center text-gray-500 text-sm">
                    Deepfake Detection Platform - Powered by Advanced AI
                </p>
            </div>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const dropZone = document.getElementById('dropZone');
            const fileInput = document.getElementById('fileInput');
            const previewContainer = document.getElementById('previewContainer');
            const previewImage = document.getElementById('previewImage');
            const progressBar = document.getElementById('progressBar');
            const progressFill = document.getElementById('progressFill');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const resultCard = document.getElementById('resultCard');
            const resultTitle = document.getElementById('resultTitle');
            const resultBadge = document.getElementById('resultBadge');
            const confidenceValue = document.getElementById('confidenceValue');
            const confidenceFill = document.getElementById('confidenceFill');
            const realProb = document.getElementById('realProb');
            const fakeProb = document.getElementById('fakeProb');
            const explanation = document.getElementById('explanation');

            // Event listeners for drag & drop
            dropZone.addEventListener('click', () => fileInput.click());
            
            dropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropZone.classList.add('drop-zone--over');
            });
            
            ['dragleave', 'dragend'].forEach(type => {
                dropZone.addEventListener(type, () => {
                    dropZone.classList.remove('drop-zone--over');
                });
            });
            
            dropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropZone.classList.remove('drop-zone--over');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    updateThumbnail(e.dataTransfer.files[0]);
                }
            });
            
            fileInput.addEventListener('change', () => {
                if (fileInput.files.length) {
                    updateThumbnail(fileInput.files[0]);
                }
            });

            // Function to display the file preview
            function updateThumbnail(file) {
                // Reset the UI
                resultCard.style.display = 'none';
                progressFill.style.width = '0%';
                
                // Show thumbnail
                previewContainer.style.display = 'block';
                
                // File validation (only images)
                if (!file.type.startsWith('image/')) {
                    alert('Please upload an image file.');
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = () => {
                    previewImage.src = reader.result;
                    uploadAndAnalyze(file);
                };
                
                reader.readAsDataURL(file);
            }

            // Function to upload and analyze the image
            function uploadAndAnalyze(file) {
                // Show loading indicators
                loadingSpinner.style.display = 'block';
                startProgressBar();
                
                const formData = new FormData();
                formData.append('file', file);
                formData.append('model_type', 'resnet'); // Use the model type that's working
                formData.append('return_visualization', 'true');
                
                fetch('/detect/image', {
                    method: 'POST',
                    body: formData
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // Stop loading indicators
                    loadingSpinner.style.display = 'none';
                    stopProgressBar();
                    
                    // Display results
                    displayResults(data);
                })
                .catch(error => {
                    console.error('Error:', error);
                    loadingSpinner.style.display = 'none';
                    stopProgressBar();
                    alert('Error analyzing image. Please try again.');
                });
            }

            // Functions for the animated progress bar (simulated)
            function startProgressBar() {
                let width = 0;
                const interval = setInterval(() => {
                    if (width >= 90) {
                        clearInterval(interval);
                    } else {
                        width += Math.random() * 5;
                        progressFill.style.width = width + '%';
                    }
                }, 300);
                progressFill.dataset.interval = interval;
            }

            function stopProgressBar() {
                clearInterval(parseInt(progressFill.dataset.interval));
                progressFill.style.width = '100%';
                setTimeout(() => {
                    progressFill.style.width = '0%';
                }, 700);
            }

            // Function to display the analysis results
            function displayResults(data) {
                // Format probabilities as percentages
                const realProbability = (data.real_probability * 100).toFixed(2) + '%';
                const fakeProbability = (data.fake_probability * 100).toFixed(2) + '%';
                const confidence = (data.confidence * 100).toFixed(2) + '%';
                
                // Update the UI elements
                realProb.textContent = realProbability;
                fakeProb.textContent = fakeProbability;
                confidenceValue.textContent = confidence;
                confidenceFill.style.width = confidence;
                
                // Set the result card styling based on prediction
                if (data.prediction === 'real') {
                    resultCard.className = 'result-card p-6 real';
                    resultTitle.textContent = 'Analysis Result: Real Image';
                    resultBadge.textContent = 'Real';
                    resultBadge.className = 'px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800';
                    confidenceFill.style.backgroundColor = '#10b981'; // Green
                    explanation.textContent = 'Our model has determined this is likely a real, unmanipulated image based on consistent facial features and natural patterns.';
                } else {
                    resultCard.className = 'result-card p-6 fake';
                    resultTitle.textContent = 'Analysis Result: Deepfake Detected';
                    resultBadge.textContent = 'Fake';
                    resultBadge.className = 'px-3 py-1 rounded-full text-sm font-medium bg-red-100 text-red-800';
                    confidenceFill.style.backgroundColor = '#ef4444'; // Red
                    explanation.textContent = 'Our model has detected signs of manipulation in this image, suggesting it may be a deepfake. The analysis found inconsistencies in facial features and unnatural patterns.';
                }
                
                // Show the result card
                resultCard.style.display = 'block';
            }
        });
    </script>
</body>
</html>